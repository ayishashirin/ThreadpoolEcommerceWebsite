<!-- header -->
<%- include('../includes/userSide/header') %>
<!-- end of header -->

<style>
  .active {
    font-weight: bold;
  }
</style>

<div class="page-title-area">
  <div class="container">
    <div class="page-title-content">
      <h2><%= category.pName %></h2>
      <ul>
        <li><a href="/">Home</a></li>
        <li>Products</li>
      </ul>
    </div>
  </div>
</div>

<section class="products-area pt-100 pb-70">
  <div class="container">
    <div class="row">
  
      

<div class="col-lg-4 col-md-12">
    <div class="woocommerce-widget-area">
        <div class="woocommerce-widget collections-list-widget">
            <h3 class="woocommerce-widget-title">Collections</h3>
            <ul class="collections-list-row">
                <li><a href="/category?genderCat=Men" class="collection-filter" data-collection="men">Men's</a></li>
                <li><a href="/category?genderCat=Women" class="collection-filter active" data-collection="women">Women’s</a></li>
            </ul>
        </div>
          <div class="woocommerce-widget price-list-widget">
            <h3 class="woocommerce-widget-title">Price</h3>
            <div class="collection-filter-by-price">
              <input
                class="js-range-of-price"
                type="text"
                data-min="1"
                data-max="1055"
                name="filter_by_price"
                data-step="10"
              />
            </div>
          </div>
         
          <div class="woocommerce-widget size-list-widget">
            <h3 class="woocommerce-widget-title">Size</h3>
            <ul class="size-list-row">
              <li><a href="#" class="size-filter">XS</a></li>
              <li><a href="#" class="size-filter">S</a></li>
              <li><a href="#" class="size-filter">M</a></li>
              <li><a href="#" class="size-filter">L</a></li>
              <li><a href="#" class="size-filter">XL</a></li>
            </ul>
          </div>

          <div class="woocommerce-widget color-list-widget">
            <h3 class="woocommerce-widget-title">Color</h3>
            <ul class="color-list-row">
              <li class="active">
                <a href="#" title="Black" class="color-black"></a>
              </li>
              <li><a href="#" title="Red" class="color-red"></a></li>
              <li><a href="#" title="Yellow" class="color-yellow"></a></li>
              <li><a href="#" title="White" class="color-white"></a></li>
              <li><a href="#" title="Blue" class="color-blue"></a></li>
            </ul>
          </div>

          <div class="d-flex justify-content-center ">
            <button type="submit" class="default-btn">Apply Filter</button>
          </div>

          <div class="woocommerce-widget aside-trending-widget pt-5">
            <div class="aside-trending-products">
              <img src="/userSide/img/offer-bg.jpg" alt="image" />
              <div class="category">
                <h3>Top Trending</h3>
                <span>Spring/Summer 2021 Collection</span>
              </div>
              <a href="#" class="link-btn"></a>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-8 col-md-12">
        <div class="products-filter-options">
          <div class="row align-items-center">
            <div class="col-lg-4 col-md-4">
              <div class="d-lg-flex d-md-flex align-items-center">
                <span class="sub-title d-lg-none"
                  ><a
                    href="#"
                    data-bs-toggle="modal"
                    data-bs-target="#productsFilterModal"
                    ><i class="bx bx-filter-alt"></i> Filter</a
                  ></span
                >
                <span class="sub-title d-none d-lg-block d-md-block"
                  >View:</span
                >
                <div class="view-list-row d-none d-lg-block d-md-block">
                  <div class="view-column">
                    <a href="#" class="icon-view-one">
                      <span></span>
                    </a>
                    <a href="#" class="icon-view-two active">
                      <span></span>
                      <span></span>
                    </a>
                    <a href="#" class="icon-view-three">
                      <span></span>
                      <span></span>
                      <span></span>
                    </a>
                    <a href="#" class="view-grid-switch">
                      <span></span>
                      <span></span>
                    </a>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-4 col-md-4">
              <!-- <p>Showing 1 – 18 of 100</p> -->
            </div>
            <div class="col-lg-4 col-md-4">
              <div class="products-ordering-list">
                <select>
                  <option>Sort by Price: Low to High</option>
                  <option>Default Sorting</option>
                  <option>Sort by Popularity</option>
                  <option>Sort by Average Rating</option>
                  <option>Sort by Latest</option>
                  <option>Sort by Price: High to Low</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <div id="products-collections-filter" class="row">
          <% for( let i = 0; i < products.length; i++ ) { %>
          <div class="col-lg-6 col-md-6 col-sm-6 products-col-item">
            <div class="shopItems" onclick="location.href='/productDetail/<%= products[i]._id %>';" >

              <div class="products-box">
                <div class="products-image">
                  <a href="/productDetail/<%= products[i]._id %>">
                    <img
                      src="<%= products[i].variations[0].images[0] %>"
                      class="main-image"
                      alt="image"
                    />
                    <img
                      src="<%= products[i].variations[0].images[0] %>"
                      class="hover-image"
                      alt="image"
                    />
                  </a>
                  <div class="products-button">
                    <ul>
                      <li>
                        <div class="wishlist-btn">
                          <a href="#" class="addToWishlist" data-product-id="<%= products._id  %>">
                            <i class="bx bx-heart"></i>
                            <span class="tooltip-label">Add to Wishlist</span>
                          </a>
                        </div>
                      </li>
                      
                   
                      <li>
                        <div class="quick-view-btn">
                          <a
                            href="/productDetail/<%= products[i]._id %>"
                            data-bs-toggle="modal"
                            data-bs-target="#productsQuickView<%= products[i].pName  %>"
                          >
                            <i class="bx bx-search-alt"></i>
                            <span class="tooltip-label">Quick View</span>
                          </a>
                        </div>
                      </li>
                    </ul>
                  </div>
                  <!-- <div class="new-tag">New!</div> -->
                </div>
                <div class="products-content">
                  <span class="category"><%= products[i].category %></span>
                  <h3><a href="#"><%= products[i].pName %></a></h3>
                  <div class="star-rating">
                    <i class="bx bxs-star"></i>
                    <i class="bx bxs-star"></i>
                    <i class="bx bxs-star"></i>
                    <i class="bx bxs-star"></i>
                    <i class="bx bxs-star"></i>
                  </div>
                  <div class="price">
                    <span class="old-price">$<%= parseInt(products[i].fPrice) %></span>
                    <span class="new-price">$<%= parseInt(products[i].lPrice) %></span>
                  </div>
                  <% if (products[i].variations[0].quantity === 0) { %>
                    <button class="buyBtn">Out Of Stock</button>
                <% } else { %>
                    <% if (isCartItem) { %>
                        <a href="/addToCart" class="add-to-cart" style="cursor: pointer;">Go to Cart</a>
                    <% } else { %>
                        <a  data-productId="<%= products[i]._id %>" class="add-to-cart" style="cursor: pointer;" >Add to Cart</a>
                    <% } %>
                <% } %>
                </div>


                <span class="products-discount">
                  <span> <%= (parseInt(products[i].fPrice))- (parseInt(products[i].lPrice))%> %OFF  </span>
                </span>


              </div>
            </div>
          </div>


          <% } %> 
      </div>
        </div>

        <% if (products.length === 0) { %>
        <div class="errNoProduct">
          <p
            style="
              display: flex;
              max-height: max-content;
              justify-content: center;
              font-weight: bolder;
              size: 50px;
            "
          >
            <span>\(^Д^)/ </span> No Products.
          </p>
        </div>
        <% } %>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const sizeFilters = document.querySelectorAll(".size-filter");

    sizeFilters.forEach(function (sizeFilter) {
      sizeFilter.addEventListener("click", function (event) {
        event.preventDefault();
        const selectedSize = this.innerText;
        filterProductsBySize(selectedSize);
        // Remove active class from all sizes
        sizeFilters.forEach(function (filter) {
          filter.classList.remove("active");
        });
        // Add active class to the clicked size
        this.classList.add("active");
      });
    });

    function filterProductsBySize(size) {
      // Implement your filtering logic here
      console.log("Filtering by size:", size);
      // Example: You can show/hide products based on the selected size
    }
  });
</script>
<% for( let i = 0; i < products.length; i++ ) { %>
  <div class="modal fade productsQuickView" id="productsQuickView<%= products[i].pName  %>" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true"><i class="bx bx-x"></i></span>
            </button>
            <div class="row align-items-center">
                <div class="col-lg-6 col-md-6">
                    <div class="products-image">
                        <img src="<%= products[i].variations[0].images[0] %>" alt="image">
                        </div>
                </div>
                <div class="col-lg-6 col-md-6">
                    <div class="products-content">
                        <h3><a href="#"><%= products[i].pName  %></a></h3>
                        <div class="price">
                            <span class="old-price">$<%= products[i].fPrice  %></span>
                            <span class="new-price">$<%= products[i].lPrice  %></span>
                        </div>
                        <div class="products-review">
                            <div class="rating">
                                <i class="bx bxs-star"></i>
                                <i class="bx bxs-star"></i>
                                <i class="bx bxs-star"></i>
                                <i class="bx bxs-star"></i>
                                <i class="bx bxs-star"></i>
                            </div>
                            <a href="#" class="rating-count">3 reviews</a>
                        </div>
                        <ul class="products-info">
                            
                            <li><span>Availability:</span> <a href="#">In stock ($<%= products[i].quantity %> items)</a></li>
                            
                        </ul>
                        <div class="products-color-switch">
                            <h4>Color:</h4>
                            <ul>
                                <li><a href="#" data-bs-toggle="tooltip" data-placement="top" title="Black"
                                    class="color-black"></a></li>
                                <li><a href="#" data-bs-toggle="tooltip" data-placement="top" title="White"
                                    class="color-white"></a></li>
                                <li><a href="#" data-bs-toggle="tooltip" data-placement="top" title="Red"
                                    class="color-red"></a></li>
                                <li><a href="#" data-bs-toggle="tooltip" data-placement="top" title="Yellow"
                                    class="color-yellow"></a></li>
                                <li><a href="#" data-bs-toggle="tooltip" data-placement="top" title="Blue"
                                    class="color-blue"></a></li>
                            </ul>
                        </div>
                        <div class="products-size-wrapper">
                            <h4>Size:</h4>
                            <ul>
                                <li><a href="#">XS</a></li>
                                <li class="active"><a href="#">S</a></li>
                                <li><a href="#">M</a></li>
                                <li><a href="#">XL</a></li>
                                <li><a href="#">L</a></li>
                                <li><a href="#">XXL</a></li>
                            </ul>
                        </div>
                        <div class="products-add-to-cart">
                            <div class="input-counter">
                                <span class="minus-btn"><i class="bx bx-minus"></i></span>
                                <input type="text" value="1" min="1">
                                    <span class="plus-btn"><i class="bx bx-plus"></i></span>
                                </div>
                            <button type="submit" class="default-btn">Add to Cart</button>
                        </div>
                        <!-- <a href="#" class="view-full-info">View Full Info</a> -->
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>
<% } %>


<div class="pagination-area text-center">
  <a href="#" class="prev page-numbers"><i class="bx bx-chevron-left"></i></a>
  <span class="page-numbers current" aria-current="page">1</span>
  <a href="#" class="page-numbers">2</a>
  <a href="#" class="next page-numbers"><i class="bx bx-chevron-right"></i></a>
</div>
<!-- Include SweetAlert JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>

document.addEventListener("DOMContentLoaded", function() {
  const addToCartButtons = document.querySelectorAll(".add-to-cart");

  addToCartButtons.forEach(function(button) {
    button.addEventListener("click", function(event) {
      event.stopPropagation();
      event.preventDefault();
      console.log('jkhkhkjh');
      
      const productId = button.getAttribute('data-productId');
      console.log(productId,'kjhkjhjhj'); // Adjust this to get the product ID from your HTML
      
      axios.get(`/cartNow/${productId}`)
      .then(res => {
        console.log(res);
        if (res.data.success) {
          console.log("gfgfgdgf");
          // Show success SweetAlert
          Swal.fire({
            icon: 'success',
            title: 'Success',
            text: res.data.message,
            timer: 3000, // Adjust the time (in milliseconds) the alert is displayed
            timerProgressBar: true
          })
          .then(isTrue=>{
            console.log(isTrue);
              if((isTrue.isDismissed || isTrue.isConfirmed) && res.data.url){
                location.href = res.data.url;
              }
          })
        } else {
          // Show error SweetAlert
          Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'Failed to add product to cart'
          });
        }
      })
      .catch(error => {
        console.error("Error adding product to cart:", error);
        // Show error SweetAlert
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'Failed to add product to cart'
        });
      });
    });
  });
});
</script>


<script>
  // Assuming you're using jQuery for simplicity
  $(document).ready(function() {
    $('.addToWishlist').click(function(e) {
      e.preventDefault();
      var productId = $(this).data('');
      $.ajax({
        url: '/wishListNow/' + productId,
        type: 'GET',
        success: function(response) {
          if (response.success) {
            alert(response.message);
            window.location.reload(); // Refresh the page after adding to wishlist
          } else {
            alert(response.message);
          }
        },
        error: function(xhr, status, error) {
          console.error(error);
          alert('An error occurred while adding to wishlist.');
        }
      });
    });
  });
</script>


<script>
  $(document).ready(function() {
    $('.addToWishlist').click(function(e) {
      e.preventDefault();
      var productId = $(this).data('product-id');
      $.ajax({
        url: '/wishListNow/' + productId,
        type: 'GET',
        success: function(response) {
          if (response.success) {
            // Show success toast message
            $('.toast-body').text(response.message);
            $('.toast').toast('show');
            window.location.reload(); // Refresh the page after adding to wishlist
          } else {
            // Show error toast message
            $('.toast-body').text(response.message);
            $('.toast').toast('show');
          }
        },
        error: function(xhr, status, error) {
          console.error(error);
          // Show error toast message
          $('.toast-body').text('An error occurred while adding to wishlist.');
          $('.toast').toast('show');
        }
      });
    });
  });
</script>

<!-- Filter script -->

<script type="text/javascript">
 function search() {
    let filter = document.getElementById('find').value.toUpperCase(); 
    let items = document.querySelectorAll('.products-box h3');
    
    for (var i = 0; i < items.length; i++) {
        let value = items[i].textContent || items[i].innerText; // Using textContent as it's widely supported
        if (value.toUpperCase().indexOf(filter) > -1) {
            items[i].parentNode.style.display = "";   
        } else {
            items[i].parentNode.style.display = "none";
        }
    }
}


</script>





<!-- footer -->
<%- include('../includes/userSide/footer') %>
<!-- end of footer -->
